ç¬¬ä¸€æ­¥ï¼šå®‰è£… JSON éªŒè¯å·¥å…·
# å®‰è£… JSON éªŒè¯å·¥å…· (Ubuntu/Debian)
sudo apt-get update
sudo apt-get install -y jq python3-pip

# å®‰è£… jsonlint
sudo pip3 install demjson3

# éªŒè¯å®‰è£…
which jsonlint && echo "âœ… jsonlint å·²å®‰è£…" || echo "ğŸ”„ å°†ä½¿ç”¨ jq éªŒè¯"


ç¬¬äºŒæ­¥ï¼šéªŒè¯å¹¶ä¿®å¤ JSON é…ç½®
# 1. å¤‡ä»½å½“å‰é…ç½®
sudo mkdir -p /etc/docker
sudo cp /etc/docker/daemon.json /etc/docker/daemon.json.backup 2>/dev/null || true

# 2. åˆ›å»ºä¼˜åŒ–çš„é…ç½®æ–‡ä»¶ (å…¼å®¹ Ubuntu 24.04)
cat <<EOF | sudo tee /etc/docker/daemon.json
{
  "insecure-registries": [
    "192.168.40.249:8929",
    "192.168.40.249"
  ],
  "features": {
    "buildkit": false
  },
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m",
    "max-file": "3"
  }
}
EOF

# 3. éªŒè¯ JSON è¯­æ³• (ä½¿ç”¨ jq)
if command -v jq &> /dev/null; then
  sudo jq empty /etc/docker/daemon.json && echo "âœ… JSON è¯­æ³•æ­£ç¡® (jq éªŒè¯)" || echo "âŒ JSON è¯­æ³•é”™è¯¯"
else
  echo "â„¹ï¸ jq æœªå®‰è£…ï¼Œè·³è¿‡ JSON è¯­æ³•éªŒè¯"
fi

 

 ç¬¬ä¸‰æ­¥ï¼šåº”ç”¨ä¿®å¤å¹¶é‡å¯æœåŠ¡
# 1. é‡æ–°åŠ è½½ systemd é…ç½®
sudo systemctl daemon-reload

# 2. åœæ­¢ Docker æœåŠ¡
sudo systemctl stop docker docker.socket containerd 2>/dev/null || true

# 3. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
sudo rm -rf /var/run/docker* /var/run/containerd*

# 4. å¯åŠ¨æœåŠ¡
sudo systemctl start containerd
sudo systemctl start docker

# 5. éªŒè¯çŠ¶æ€
if sudo systemctl is-active --quiet docker; then
  echo "âœ… Docker æœåŠ¡å¯åŠ¨æˆåŠŸï¼"
  echo "å½“å‰é…ç½®éªŒè¯:"
  sudo docker info | grep -E "(Server Version|Cgroup Driver|Storage Driver|Insecure Registries)"
else
  echo "âŒ Docker æœåŠ¡å¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹è¯¦ç»†æ—¥å¿—:"
  sudo journalctl -u docker.service -n 50 --no-pager
fi